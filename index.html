<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.G.E - Brigada HSM (Final Integrado)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* === VARI√ÅVEIS GERAIS === */
        :root {
            --sidebar-bg: #0f172a;
            --main-bg: #f3f4f6;
            --card-bg: #ffffff;
            --primary-red: #dc2626;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --info-blue: #3b82f6;
            
            /* Vari√°veis da Escala */
            --escala-header: #1e293b;
            --escala-accent: #f97316;
            --sd-bg: #dcfce7; --sd-txt: #166534;
            --sn-bg: #dbeafe; --sn-txt: #1e40af;
            --f-bg: #f8fafc;  --f-txt: #94a3b8;
            --ferias-bg: #ffedd5; --ferias-txt: #9a3412;
            --border-light: #e2e8f0;

            /* Vari√°veis Treinamento */
            --radius: 10px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body { display: flex; height: 100vh; background-color: var(--main-bg); overflow: hidden; }

        /* === FEEDBACK DE EDI√á√ÉO === */
        [contenteditable="true"] { outline: none; transition: background 0.2s; border-radius: 4px; padding: 0 4px; }
        [contenteditable="true"]:hover { background-color: rgba(249, 115, 22, 0.1); cursor: text; box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.2); }
        [contenteditable="true"]:focus { background-color: white; box-shadow: 0 0 0 2px var(--escala-accent); color: #1e293b; }

        /* === SIDEBAR === */
        .sidebar { width: 260px; background-color: var(--sidebar-bg); color: white; display: flex; flex-direction: column; padding: 20px 0; flex-shrink: 0; transition: 0.3s; }
        .brand { padding: 0 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .brand h2 { font-size: 16px; font-weight: 800; letter-spacing: 0.5px; }
        .brand span { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; display: block; margin-top: 4px; }
        
        .user-profile { padding: 24px; display: flex; align-items: center; gap: 12px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-red); }
        .user-info h4 { font-size: 14px; color: #fff; }
        .user-info p { font-size: 10px; color: var(--primary-red); font-weight: bold; text-transform: uppercase; }

        .nav-menu { list-style: none; margin-top: 10px; flex: 1; }
        .nav-item { display: flex; align-items: center; padding: 12px 24px; color: #94a3b8; text-decoration: none; font-size: 14px; transition: 0.3s; cursor: pointer; }
        .nav-item:hover { color: white; background: rgba(255,255,255,0.05); }
        .nav-item.active { color: white; background: rgba(255,255,255,0.05); border-left: 4px solid var(--primary-red); }
        .nav-item i { width: 24px; }

        .logout { padding: 20px 24px; color: #94a3b8; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .logout:hover { color: var(--primary-red); }

        /* === MAIN CONTENT AREA === */
        .main-content { flex: 1; padding: 24px 32px; overflow-y: auto; position: relative; }
        
        /* Views Control */
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === DASHBOARD CSS === */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .header-title h1 { font-size: 18px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 10px; }
        .status-pill { background: rgba(16, 185, 129, 0.1); color: var(--success-green); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .status-dot { width: 6px; height: 6px; background: var(--success-green); border-radius: 50%; }
        .date-info { font-size: 12px; color: var(--text-secondary); font-weight: 500; text-align: right; }

        .top-grid { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; margin-bottom: 24px; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); position: relative; }
        
        .welcome-card { background: linear-gradient(90deg, rgba(26,31,54,0.9) 0%, rgba(26,31,54,0.4) 100%), url('https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?auto=format&fit=crop&q=80&w=800'); background-size: cover; background-position: center; color: white; display: flex; flex-direction: column; justify-content: center; }
        .metric-value { font-size: 28px; font-weight: 700; color: var(--text-primary); }
        .metric-sub.warning { color: var(--warning-orange); font-size: 12px; font-weight: 600; }
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; }

        /* Timeline Styles */
        .timeline-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid #f1f5f9; }
        .timeline-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .icon-green { background: rgba(16, 185, 129, 0.1); color: var(--success-green); }
        .icon-orange { background: rgba(245, 158, 11, 0.1); color: var(--warning-orange); }

        /* Team Widget */
        .team-card { background-color: #1e293b; color: white; border-radius: 12px; padding: 20px; height: 100%; display: flex; flex-direction: column; }
        .team-list { display: flex; flex-direction: column; gap: 12px; margin-top: 15px; flex: 1; }
        .team-member { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 8px; background: rgba(255,255,255,0.05); }
        .team-member img { width: 36px; height: 36px; border-radius: 50%; }

        /* === ESCALA & TREINAMENTO HEADER STYLE (UNIFICADO) === */
        /* Classe compartilhada para manter o visual bonito */
        .section-dark-header {
            background: var(--escala-header); 
            color: white; 
            padding: 15px 25px; 
            border-radius: 12px;
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 4px solid var(--escala-accent);
            margin-bottom: 20px;
        }

        .escala-container { display: flex; flex-direction: column; gap: 16px; }
        .month-control { background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 50px; display: flex; align-items: center; gap: 15px; backdrop-filter: blur(5px); }
        .nav-arrow { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; }
        .escala-actions button { background-color: var(--escala-accent); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.85rem; margin-left: 10px; }
        .btn-reset { background-color: #475569 !important; }

        .table-paper { background-color: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid var(--border-light); }
        .table-scroll { overflow-x: auto; }
        table { border-collapse: separate; border-spacing: 0; width: 100%; min-width: 1200px; }
        th, td { padding: 8px 4px; text-align: center; border-right: 1px solid var(--border-light); border-bottom: 1px solid var(--border-light); font-size: 0.75rem; }
        .th-days { background-color: #334155; color: white; height: 35px; }
        .th-week { background-color: #f8fafc; color: #334155; font-weight: 800; font-size: 0.7rem; }
        .col-sticky { position: sticky; left: 0; z-index: 10; background-color: #f1f5f9; width: 180px; text-align: left; padding-left: 10px; font-weight: 600; }
        .col-id { position: sticky; left: 180px; z-index: 10; background-color: #f8fafc; width: 50px; font-family: monospace; color: #64748b; }
        .section-header-row { background: linear-gradient(90deg,#1e40af 0%,#1e3a8a 100%); color: white; text-align: left; padding: 6px 15px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }

        .cell-status { cursor: pointer; font-weight: 700; transition: 0.1s; user-select: none; }
        .cell-status:hover { transform: scale(1.15); z-index: 10; box-shadow: 0 0 4px rgba(0,0,0,0.2); }
        .st-sd { background-color: var(--sd-bg); color: var(--sd-txt); }
        .st-sn { background-color: var(--sn-bg); color: var(--sn-txt); }
        .st-f  { background-color: var(--f-bg);  color: var(--f-txt); }
        .st-ferias { background-color: var(--ferias-bg); color: var(--ferias-txt); font-size: 0.65rem; }
        .st-fs { background-color: #fff; color: #334155; }
        .weekend-th { background-color: #e2e8f0; color: #dc2626; }
        .weekend-col { background-image: linear-gradient(to bottom,rgba(148,163,184,0.12),rgba(248,250,252,0.3)); }

        .footer-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; margin-top: 5px; }
        .check-card { background: white; border-radius: 12px; border: 1px solid var(--border-light); display: flex; flex-direction: column; overflow: hidden; }
        .card-title-purple { background-color: #7c3aed; color: white; padding: 6px; text-align: center; font-weight: 700; font-size: 0.75rem; text-transform: uppercase; }
        .task-row { display: flex; border-bottom: 1px solid #f1f5f9; padding: 4px 8px; font-size: 0.75rem; justify-content: space-between; }
        .task-name { font-weight: 600; color: #334155; }
        .task-desc { color: #64748b; }
        .alert-box { background-color: #fef9c3; color: #854d0e; padding: 8px; text-align: center; font-size: 0.7rem; margin-top: auto; border-top: 1px solid #fde047; }

        /* === ESTILOS TREINAMENTO === */
        .training-controls { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }

        .training-filters { display: flex; gap: 10px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); align-items: center; }
        .filter-btn { background: transparent; border: none; padding: 8px 16px; border-radius: 8px; font-size: 0.9rem; color: #64748b; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 8px; }
        .filter-btn:hover { background: #f1f5f9; color: var(--text-primary); }
        .filter-btn.active { background: #1e293b; color: white; }

        .training-progress-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 15px 20px; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; }
        .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .fill { height: 100%; background: #ef4444; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

        .module-list { display: flex; flex-direction: column; gap: 16px; }
        .module-card { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow-sm); border: 1px solid var(--border-light); overflow: hidden; transition: all 0.3s ease; }
        .module-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .module-card.done-border { border-left: 4px solid #10b981; }

        .card-header { padding: 1.25rem 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: space-between; background: white; user-select: none; }
        .header-left { display: flex; align-items: center; gap: 20px; flex: 1; }
        
        .status-dot-t { width: 24px; height: 24px; border-radius: 50%; background: #f1f5f9; border: 2px solid #e2e8f0; display: flex; align-items: center; justify-content: center; color: transparent; font-size: 12px; transition: all 0.3s; }
        .status-dot-t.done { background: #10b981; border-color: #10b981; color: white; }

        .module-title h3 { font-size: 1.05rem; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
        .module-title span { font-size: 0.85rem; color: var(--text-secondary); font-weight: 400; }

        .badge { font-size: 0.75rem; padding: 5px 12px; border-radius: 20px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge.lid { background: #f3e8ff; color: #7e22ce; }
        .badge.tec { background: #e0f2fe; color: #0369a1; }
        .badge.comp { background: #dcfce7; color: #15803d; }

        .expand-icon { color: #94a3b8; transition: transform 0.3s; font-size: 0.9rem; margin-left: 15px; }
        .module-card.active .expand-icon { transform: rotate(180deg); color: #1e293b; }
        .module-card.active .card-header { background: #f8fafc; border-bottom: 1px solid var(--border-light); }

        .card-body { max-height: 0; overflow: hidden; transition: max-height 0.4s cubic-bezier(0, 1, 0, 1); background: #fff; }
        .module-card.active .card-body { max-height: 2000px; transition: max-height 0.5s ease-in-out; }

        .content-wrapper { padding: 2.5rem; display: grid; grid-template-columns: 1.8fr 1.2fr; gap: 3rem; }
        .training-h4 { font-size: 0.8rem; text-transform: uppercase; color: #94a3b8; margin-bottom: 1.2rem; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }

        .theory-block li { list-style: none; margin-bottom: 16px; font-size: 0.95rem; line-height: 1.6; color: #475569; padding-left: 15px; border-left: 2px solid var(--border-light); }
        .theory-block li strong { color: #1e293b; display: block; margin-bottom: 4px; }

        .drill-box { background: #f8fafc; border: 1px solid #e2e8f0; padding: 1.5rem; border-radius: 12px; position: relative; }
        .drill-box::before { content: ''; position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; background: #ef4444; border-radius: 0 4px 4px 0; }
        .drill-box strong { display: block; color: #1e293b; margin-bottom: 8px; font-size: 1rem; }
        .drill-box p { font-size: 0.9rem; color: #64748b; line-height: 1.6; font-style: italic; }

        .mistake-alert { margin-top: 1.5rem; padding: 1rem; background: #fef2f2; border-radius: 8px; color: #b91c1c; font-size: 0.85rem; display: flex; gap: 10px; align-items: flex-start; }
        .action-btn { background: white; color: var(--text-primary); border: 1px solid #cbd5e1; padding: 10px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; float: right; margin-top: 20px;}
        .action-btn:hover { background: #f1f5f9; border-color: #94a3b8; }
        .action-btn.completed { background: #10b981; color: white; border-color: #10b981; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .action-btn.completed:hover { background: #059669; }

        @media print {
            .sidebar { display: none; }
            .main-content { padding: 0; margin: 0; overflow: visible; }
            #view-dashboard, #view-treinamentos { display: none; }
            #view-escala { display: block; }
            .section-dark-header { border-radius: 0; color: black; background: none; border: none; padding: 10px 0; }
            .section-dark-header h1 { color: black; }
            .section-header-row { background: #cbd5e1 !important; color: black !important; -webkit-print-color-adjust: exact; }
            .st-sd { background: #dcfce7 !important; -webkit-print-color-adjust: exact; }
            .st-sn { background: #dbeafe !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="brand">
            <h2 id="sb_brand" contenteditable="true" onblur="globalEditor.save(this)">BRIGADA HSM</h2>
            <span id="sb_sub" contenteditable="true" onblur="globalEditor.save(this)">Hospital Santa Marta</span>
        </div>
        <div class="user-profile">
            <img src="https://ui-avatars.com/api/?name=Medeiros&background=dc2626&color=fff" alt="User" class="avatar">
            <div class="user-info">
                <h4 id="sb_user_name" contenteditable="true" onblur="globalEditor.save(this)">Medeiros</h4>
                <p id="sb_user_role" contenteditable="true" onblur="globalEditor.save(this)">Chefe de Brigada</p>
            </div>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="switchView('dashboard', this)">
                <i class="fa-solid fa-table-columns"></i> Dashboard
            </li>
            <li class="nav-item" onclick="switchView('escala', this)">
                <i class="fa-solid fa-calendar-days"></i> Escala
            </li>
            <li class="nav-item">
                <i class="fa-solid fa-plane-departure"></i> F√©rias
            </li>
            <li class="nav-item" onclick="switchView('treinamentos', this)">
                <i class="fas fa-graduation-cap"></i> Treinamentos
            </li>
        </ul>
        <div class="logout"><i class="fa-solid fa-power-off"></i> Sair</div>
    </aside>

    <main class="main-content">
        
        <div id="view-dashboard" class="view-section active">
            <header class="header">
                <div class="header-title">
                    <h1 id="dash_title" contenteditable="true" onblur="globalEditor.save(this)"><i class="fa-solid fa-grip"></i> Vis√£o Geral</h1>
                </div>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <div class="status-pill"><div class="status-dot"></div> <span id="dash_status" contenteditable="true" onblur="globalEditor.save(this)">HSM Operante</span></div>
                    <div class="date-info" id="dashboardDate"></div>
                </div>
            </header>

            <div class="top-grid">
                <div class="card welcome-card">
                    <h2 id="dash_hero_title" contenteditable="true" onblur="globalEditor.save(this)">Ol√°, Chefe Medeiros</h2>
                    <p id="dash_hero_sub" contenteditable="true" onblur="globalEditor.save(this)">O sistema de escala e monitoramento est√° ativo e sincronizado.</p>
                </div>
                <div class="card">
                    <div style="font-size: 10px; color: var(--text-secondary); font-weight: 700;">Extintores Vencendo</div>
                    <div class="metric-value"><span id="metric_ext" contenteditable="true" onblur="globalEditor.save(this)">3</span> <span class="metric-sub warning" id="metric_local" contenteditable="true" onblur="globalEditor.save(this)">Setor UTI</span></div>
                    <i class="fa-solid fa-triangle-exclamation" style="position:absolute; top:20px; right:20px; color:var(--warning-orange);"></i>
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <h3 style="font-size: 16px; margin-bottom: 15px; display:flex; gap:8px; align-items:center;">
                        <i class="fa-solid fa-clock-rotate-left" style="color: var(--primary-red);"></i> 
                        <span contenteditable="true" onblur="globalEditor.save(this)" id="dash_ocur_title">Di√°rio de Ocorr√™ncias</span>
                    </h3>
                    
                    <div class="timeline-item">
                        <div class="timeline-icon icon-green"><i class="fa-solid fa-check"></i></div>
                        <div style="width:100%">
                            <h5 style="font-size:14px;" id="t_item1_title" contenteditable="true" onblur="globalEditor.save(this)">Vistoria Ala Pedi√°trica</h5>
                            <p style="font-size:12px; color:#64748b;" id="t_item1_desc" contenteditable="true" onblur="globalEditor.save(this)">Rotas desobstru√≠das.</p>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-icon icon-orange"><i class="fa-solid fa-bell"></i></div>
                        <div style="width:100%">
                            <h5 style="font-size:14px;" id="t_item2_title" contenteditable="true" onblur="globalEditor.save(this)">Alarme Cozinha</h5>
                            <p style="font-size:12px; color:#64748b;" id="t_item2_desc" contenteditable="true" onblur="globalEditor.save(this)">Falso positivo.</p>
                        </div>
                    </div>
                </div>

                <div class="team-card">
                    <h3 style="font-size: 16px;">Plant√£o Hoje</h3>
                    <span style="font-size: 11px; opacity:0.7;" id="shiftLabel"></span>
                    <div class="team-list" id="teamListContainer"></div>
                    <button style="width:100%; margin-top:20px; background:#dc2626; color:white; border:none; padding:10px; border-radius:6px; font-weight:bold; cursor:pointer;" onclick="switchView('escala', document.querySelectorAll('.nav-item')[1])">Ver Escala Completa</button>
                </div>
            </div>
        </div>

        <div id="view-escala" class="view-section">
            <div class="escala-container">
                <div class="section-dark-header">
                    <div>
                        <h1 style="font-size: 1.1rem; display:flex; align-items:center; gap:10px;" id="esc_title" contenteditable="true" onblur="globalEditor.save(this)">GERENCIADOR DE ESCALA 2026 üî•</h1>
                        <span style="font-size: 0.8rem; color: #cbd5e1;" id="esc_sub" contenteditable="true" onblur="globalEditor.save(this)">Brigada de Inc√™ndio - Hospital Santa Marta</span>
                    </div>

                    <div class="month-control">
                        <button class="nav-arrow" onclick="escalaApp.changeMonth(-1)">‚ùÆ</button>
                        <div id="displayMonth">JANEIRO 2026</div>
                        <button class="nav-arrow" onclick="escalaApp.changeMonth(1)">‚ùØ</button>
                    </div>

                    <div class="escala-actions">
                        <button class="btn-reset" onclick="escalaApp.resetMonth()">‚Ü∫ Limpar M√™s</button>
                        <button onclick="window.print()">üñ® Imprimir</button>
                    </div>
                </div>

                <div class="table-paper">
                    <div class="table-scroll">
                        <table id="mainTable">
                            <thead id="tableHead"></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="footer-grid">
                    <div class="check-card">
                        <div class="card-title-purple" contenteditable="true" id="ft_t1" onblur="globalEditor.save(this)">Checklist Individual</div>
                        <div id="listCheck1" style="flex:1;"></div>
                        <div class="alert-box" contenteditable="true" id="ft_a1" onblur="globalEditor.save(this)">
                            <strong>Todos os brigadistas</strong> executam essa demanda.<br>Diariamente no Checklist e Livro.
                        </div>
                    </div>
                    <div class="check-card">
                        <div class="card-title-purple" contenteditable="true" id="ft_t2" onblur="globalEditor.save(this)">Escala de Extintores</div>
                        <div id="listCheck2" style="flex:1;"></div>
                        <div class="alert-box" contenteditable="true" id="ft_a2" onblur="globalEditor.save(this)">
                            <strong>Aten√ß√£o:</strong> Executar do dia 01/03 ao 16/03.<br>Total de 8 plant√µes.
                        </div>
                    </div>
                    <div class="check-card">
                        <div class="card-title-purple" contenteditable="true" id="ft_t3" onblur="globalEditor.save(this)">Obstru√ß√£o de Extintores e Hidrantes</div>
                        <div id="listCheck3" style="flex:1;"></div>
                        <div class="alert-box" contenteditable="true" id="ft_a3" onblur="globalEditor.save(this)">
                            <strong>Todos os brigadistas</strong> executam essa demanda.<br>Diariamente no Checklist e Livro.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-treinamentos" class="view-section">
            <div class="section-dark-header">
                <div>
                    <h2 style="font-size: 1.1rem; display:flex; align-items:center; gap:10px;" id="train_main_title" contenteditable="true" onblur="globalEditor.save(this)">PLANO DE ENSINO 2026</h2>
                    <p style="font-size: 0.8rem; color: #cbd5e1; margin-top:4px;" id="train_main_sub" contenteditable="true" onblur="globalEditor.save(this)">Diretrizes de instru√ß√£o continuada.</p>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 50px; font-size: 0.9rem;">
                    <i class="far fa-calendar-alt" style="margin-right: 8px; color: #f97316;"></i> Exerc√≠cio 2026
                </div>
            </div>

            <div class="training-controls">
                <div class="training-filters">
                    <button class="filter-btn active" onclick="treinamentosApp.filter('todos', this)">
                        <i class="fas fa-layer-group"></i> Todos
                    </button>
                    <button class="filter-btn" onclick="treinamentosApp.filter('Lideran√ßa', this)">
                        <i class="fas fa-chess-king"></i> Chefia
                    </button>
                    <button class="filter-btn" onclick="treinamentosApp.filter('T√©cnico', this)">
                        <i class="fas fa-fire-extinguisher"></i> Operacional
                    </button>
                    <button class="filter-btn" onclick="treinamentosApp.filter('Comportamental', this)">
                        <i class="fas fa-user-shield"></i> Comportamental
                    </button>
                </div>

                <div class="training-progress-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <small style="opacity: 0.8; text-transform: uppercase; font-size: 0.7rem; font-weight: 700;">Progresso</small>
                        <span id="prog-percent" style="font-size: 0.8rem; font-weight:700;">0%</span>
                    </div>
                    <div class="progress-bar"><div class="fill" id="fill"></div></div>
                    <div style="text-align: right; margin-top: 5px; font-size: 0.75rem; opacity: 0.7;">
                        <span id="prog-text">0</span> de 10 M√≥dulos
                    </div>
                </div>
            </div>

            <div id="training-grid-container" class="module-list">
                </div>
        </div>

    </main>

    <script>
        // === CONFIGURA√á√ÉO GERAL ===
        const CONFIG = {
            year: 2026,
            months: ["JANEIRO","FEVEREIRO","MAR√áO","ABRIL","MAIO","JUNHO","JULHO","AGOSTO","SETEMBRO","OUTUBRO","NOVEMBRO","DEZEMBRO"],
            weekDays: ["D","S","T","Q","Q","S","S"],
            status: [
                { code: 0, label: "SD",      class: "st-sd"      },
                { code: 1, label: "SN",      class: "st-sn"      },
                { code: 2, label: "F",       class: "st-f"       },
                { code: 3, label: "F√âRIAS",  class: "st-ferias"  },
                { code: 4, label: "FS",      class: "st-fs"      }
            ]
        };

        const DEFAULT_DATA = {
            day: [
                { name: "JOSIVALDO ROG√âRIO",   id: "4360", ptr: [0,2,0,2,0,2] },
                { name: "JOEL CARNEIRO",       id: "8187", ptr: [3,3,3,3,3,3] },
                { name: "ELLEN MARCIELI",      id: "9268", ptr: [2,0,2,0,2,0] },
                { name: "AGMAR HENRIQUE",      id: "2483", ptr: [0,2,0,2,0,2] },
                { name: "ANTONIETA MARIA",     id: "9267", ptr: [0,2,4,2,0,2] }
            ],
            night: [
                { name: "DANILO ROCHA",        id: "9252", ptr: [2,1,2,4] },
                { name: "ROSA APARECIDA",      id: "0971", ptr: [1,2,1,2] },
                { name: "PETERSON PEVIDOR",    id: "7189", ptr: [1,2,1,2] },
                { name: "JULLYANDERSON RIBEIRO",id: "9351", ptr: [1,2,4,2] }
            ]
        };

        // === GLOBAL EDITOR ===
        const globalEditor = {
            data: {},
            init() {
                const saved = localStorage.getItem('hsm_global_edits');
                if (saved) {
                    this.data = JSON.parse(saved);
                    Object.keys(this.data).forEach(id => {
                        const el = document.getElementById(id);
                        if(el) el.innerText = this.data[id];
                    });
                }
            },
            save(element) {
                if(!element.id) return;
                this.data[element.id] = element.innerText;
                localStorage.setItem('hsm_global_edits', JSON.stringify(this.data));
            }
        };

        // === NAVEGA√á√ÉO ===
        function switchView(viewName, element) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            if(element) {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                element.classList.add('active');
            }
            if(viewName === 'escala') escalaApp.init();
            if(viewName === 'treinamentos') treinamentosApp.init();
        }

        // === DASHBOARD LOGIC ===
        function initDashboard() {
            const now = new Date();
            const day = now.getDate();
            const monthIdx = now.getMonth();
            const weekNames = ["DOM", "SEG", "TER", "QUA", "QUI", "SEX", "S√ÅB"];
            
            document.getElementById('dashboardDate').innerHTML = `HOSPITAL SANTA MARTA<br><span style="color:#1e293b; font-size:14px;">${weekNames[now.getDay()]}, ${day} DE ${CONFIG.months[monthIdx].substring(0,3)}</span>`;
            document.getElementById('shiftLabel').innerText = `Equipe do dia ${day}/${monthIdx+1}`;

            const dayIndex = day - 1;
            const activeTeam = [];
            const teamsSource = (escalaApp.teams && escalaApp.teams.day) ? escalaApp.teams : DEFAULT_DATA;

            const getStatus = (member, dayIdx) => {
                if (member.ptr.length >= 28) {
                    return member.ptr[dayIdx] !== undefined ? member.ptr[dayIdx] : 2;
                } else {
                    return member.ptr[dayIdx % member.ptr.length];
                }
            };

            const checkTeam = (list, typeLabel) => {
                list.forEach(member => {
                    const statusVal = getStatus(member, dayIndex);
                    if (statusVal === 0 || statusVal === 1) {
                        activeTeam.push({ ...member, role: typeLabel });
                    }
                });
            };

            checkTeam(teamsSource.day, "Brigadista (Dia)");
            checkTeam(teamsSource.night, "Brigadista (Noite)");

            const container = document.getElementById('teamListContainer');
            if(container) {
                container.innerHTML = "";
                if(activeTeam.length === 0) {
                    container.innerHTML = "<div style='text-align:center; font-size:12px; opacity:0.7;'>Ningu√©m escalado hoje.</div>";
                } else {
                    activeTeam.forEach(p => {
                        const initials = p.name.split(" ").map(n=>n[0]).join("").substring(0,2);
                        container.innerHTML += `
                            <div class="team-member">
                                <img src="https://ui-avatars.com/api/?name=${initials}&background=random&color=fff" alt="${p.name}">
                                <div style="line-height:1.2;">
                                    <h6 style="font-size:13px; font-weight:600;">${p.name.split(" ")[0] + " " + (p.name.split(" ")[1] || "")}</h6>
                                    <span style="font-size:10px; opacity:0.7;">${p.id} ‚Ä¢ ${p.role}</span>
                                </div>
                            </div>
                        `;
                    });
                }
            }
        }

        // === ESCALA APP LOGIC ===
        const escalaApp = {
            currentMonth: 0,
            teams: {}, 

            init() {
                const now = new Date();
                if(now.getFullYear() === CONFIG.year) this.currentMonth = now.getMonth();
                
                const saved = localStorage.getItem('hsm_teams_data_fix_v2');
                if (saved) {
                    this.teams = JSON.parse(saved);
                } else {
                    this.teams = JSON.parse(JSON.stringify(DEFAULT_DATA));
                }
                this.expandPatterns(this.teams.day);
                this.expandPatterns(this.teams.night);
                this.render();
                initDashboard(); 
            },

            expandPatterns(teamList) {
                teamList.forEach(member => {
                    if (member.ptr.length < 28) {
                        const newPtr = [];
                        for (let i = 0; i < 32; i++) {
                            newPtr.push(member.ptr[i % member.ptr.length]);
                        }
                        member.ptr = newPtr;
                    }
                });
            },

            saveData() {
                localStorage.setItem('hsm_teams_data_fix_v2', JSON.stringify(this.teams));
                initDashboard();
            },

            toggle(type, memberIdx, dayIdx) {
                const currentCode = this.teams[type][memberIdx].ptr[dayIdx];
                const nextCode = (currentCode + 1) % 5;
                this.teams[type][memberIdx].ptr[dayIdx] = nextCode;
                this.saveData();
                this.render(); 
            },

            updateName(type, memberIdx, newName) {
                this.teams[type][memberIdx].name = newName;
                this.saveData();
            },

            getDaysInMonth(m) { return new Date(CONFIG.year, m + 1, 0).getDate(); },
            getStartDay(m) { return new Date(CONFIG.year, m, 1).getDay(); },

            render() {
                const m = this.currentMonth;
                const daysTotal = this.getDaysInMonth(m);
                const startDay = this.getStartDay(m);

                document.getElementById('displayMonth').innerText = `${CONFIG.months[m]} ${CONFIG.year}`;

                let htmlHead = `<tr class="th-days"><th colspan="2" style="text-align:left; padding-left:15px;">BRIGADA DE INC√äNDIO</th>`;
                for(let i=1; i<=daysTotal; i++) htmlHead += `<th>${i}</th>`;
                htmlHead += `</tr><tr class="th-week"><th class="col-sticky">NOME</th><th class="col-id">MATR.</th>`;
                
                let wd = startDay;
                for(let i=1; i<=daysTotal; i++) {
                    const isWeekend = (wd===0 || wd===6);
                    htmlHead += `<th class="${isWeekend ? 'weekend-th' : ''}">${CONFIG.weekDays[wd]}</th>`;
                    wd = (wd+1)%7;
                }
                htmlHead += `</tr>`;
                document.getElementById('tableHead').innerHTML = htmlHead;

                const tbody = document.getElementById('tableBody');
                tbody.innerHTML = "";

                const createRow = (person, type, pIdx) => {
                    let html = `<tr>
                        <td class="col-sticky" contenteditable="true" onblur="escalaApp.updateName('${type}', ${pIdx}, this.innerText)">${person.name}</td>
                        <td class="col-id">${person.id}</td>`;
                    
                    let currentWd = startDay;
                    for(let i=0; i<daysTotal; i++) {
                        const ptrIndex = i; 
                        const code = person.ptr[ptrIndex] !== undefined ? person.ptr[ptrIndex] : 2;
                        const st = CONFIG.status.find(s => s.code === code) || CONFIG.status[2];
                        const isWeekend = (currentWd===0 || currentWd===6);
                        html += `<td class="cell-status ${st.class} ${isWeekend && code !== 3 ? 'weekend-col' : ''}"
                                     onclick="escalaApp.toggle('${type}', ${pIdx}, ${ptrIndex})">
                                     ${st.label}
                                 </td>`;
                        currentWd = (currentWd+1)%7;
                    }
                    html += "</tr>";
                    return html;
                };

                tbody.innerHTML += `<tr><td colspan="${daysTotal+2}" class="section-header-row">EQUIPE DIURNA (DIA)</td></tr>`;
                this.teams.day.forEach((p, i) => tbody.innerHTML += createRow(p, 'day', i));
                
                tbody.innerHTML += `<tr><td colspan="${daysTotal+2}" class="section-header-row">EQUIPE NOTURNA (NOITE)</td></tr>`;
                this.teams.night.forEach((p, i) => tbody.innerHTML += createRow(p, 'night', i));

                this.renderFooter();
            },

            renderFooter() {
                const tasksDefault = ["Hidrantes de Parede","Bombas de Inc√™ndio","Portas de Emerg√™ncia","Aterramento e SPDA","Portas de Emerg√™ncia","Hidrantes de Parede","Aterramento e SPDA","Lumin√°rias de Emerg√™ncia","Bombas de Inc√™ndio"];
                const allStaff = [...this.teams.day, ...this.teams.night];
                
                const createList = (listId, withTask) => {
                    const container = document.getElementById(listId);
                    container.innerHTML = allStaff.map((p, i) => `
                        <div class="task-row">
                            <span class="task-name">${p.name}</span>
                            <span class="task-desc" contenteditable="true" id="${listId}_t_${p.id}" onblur="globalEditor.save(this)">${withTask ? (tasksDefault[i] || "") : ""}</span>
                        </div>
                    `).join("");
                };
                createList("listCheck1", true);
                createList("listCheck2", false);
                createList("listCheck3", false);
                globalEditor.init();
            },
            changeMonth(dir) {
                const next = this.currentMonth + dir;
                if(next >= 0 && next <= 11) {
                    this.currentMonth = next;
                    this.render();
                }
            },
            resetMonth() { 
                if(confirm("Resetar escala para o padr√£o?")) {
                    localStorage.removeItem('hsm_teams_data_fix_v2');
                    location.reload();
                }
            }
        };

        // === TREINAMENTOS APP (Full Editable) ===
        const treinamentosApp = {
            modules: [
                { id: 1, title: "Compet√™ncias Essenciais", subtitle: "Fundamentos e Postura Padr√£o", category: "Comportamental", type: "comp", theory: ["Al√ßa Fechada (Closed Loop): Protocolo obrigat√≥rio.", "O Saca-Rolha: 1. EPI ok? 2. Cena segura? 3. R√°dio funciona?", "Disciplina Sonora: R√°dio √© para comunica√ß√£o t√°tica curta."], drill: "Exerc√≠cio 'Cego': Aluno de costas recebe 3 ordens via r√°dio com ru√≠do de fundo.", mistakes: "Correr sem r√°dio; Gritar ordens sobrepostas.", key: "Na d√∫vida, n√£o corra. Pare, respire, pense, aja." },
                { id: 2, title: "Lideran√ßa Situacional", subtitle: "Comando Inicial de Crise", category: "Lideran√ßa", type: "lid", theory: ["Comando do Primeiro: O primeiro na cena √â o comandante.", "M√©todo START: Triagem r√°pida de decis√£o.", "Delega√ß√£o Direta: Aponte e fale: 'VOC√ä, pegue o extintor'."], drill: "Simula√ß√£o 'Est√°tua': L√≠der PARADO no centro dando ordens.", mistakes: "L√≠der tentar apagar o fogo sozinho.", key: "Quem faz a tarefa operacional, n√£o comanda a cena." },
                { id: 3, title: "Gest√£o de Conflitos", subtitle: "Controle de Multid√£o e P√¢nico", category: "Comportamental", type: "comp", theory: ["Identificar L√≠der Negativo: Isole quem grita.", "Disco Arranhado: Repita a ordem com calma.", "Valida√ß√£o Emocional: 'Entendo seu medo, mas saia'."], drill: "Role-Play: Ator invade √°rea gritando.", mistakes: "Entrar em debate com pessoa em p√¢nico.", key: "N√£o lute contra a emo√ß√£o da v√≠tima, gerencie o espa√ßo dela." },
                { id: 4, title: "Resili√™ncia Operacional", subtitle: "Sa√∫de Mental sob Press√£o", category: "Comportamental", type: "comp", theory: ["Box Breathing: 4s inspira, 4s segura, 4s solta.", "Vis√£o de T√∫nel: Olhe esquerda/direita para desbloquear.", "Foco na Tarefa: Divida o problema."], drill: "Desafio F√≠sico: Polichinelos + Tarefa fina.", mistakes: "Negar o medo (trava).", key: "Se travou, respira." },
                { id: 5, title: "Equipe Multidisciplinar", subtitle: "Interface Assistencial", category: "T√©cnico", type: "tec", theory: ["Respeito de Compet√™ncia: Brigada x Enfermagem.", "Prioridade: Pacientes t√™m prioridade.", "Comunica√ß√£o Unificada: Sem c√≥digos confusos."], drill: "Table Top: Cen√°rio UTI Neonatal.", mistakes: "Brigadista dando palpite m√©dico.", key: "Sincronia salva mais vidas que hero√≠smo." },
                { id: 6, title: "√âtica e Sigilo", subtitle: "Prote√ß√£o Institucional", category: "Lideran√ßa", type: "lid", theory: ["LGPD: Zero fotos de v√≠timas.", "Sigilo: Ocorrencia morre no relat√≥rio.", "Uniforme: Postura de autoridade."], drill: "Estudo de Caso: Vazamento de foto.", mistakes: "Fofoca no refeit√≥rio.", key: "Reputa√ß√£o demora 20 anos para construir, 1 clique para destruir." },
                { id: 7, title: "Gest√£o do Tempo", subtitle: "Golden Minutes", category: "T√©cnico", type: "tec", theory: ["Curva do Fogo: 1-3min extintor resolve.", "Prontid√£o: Equipamento pronto sempre.", "Triagem: Vida > Conten√ß√£o > Patrim√¥nio."], drill: "Pit Stop: Vestir EPI < 60s.", mistakes: "Discutir causa antes de apagar.", key: "Lento √© suave, suave √© r√°pido." },
                { id: 8, title: "Gest√£o de Mudan√ßas", subtitle: "Adapta√ß√£o de Cen√°rio", category: "Lideran√ßa", type: "lid", theory: ["Mapa Mental Din√¢mico: Conhe√ßa o layout DE HOJE.", "Plano B: Redund√¢ncia de equipamentos.", "L√≠der Positivo: N√£o reclame da obra."], drill: "Cen√°rio Surpresa: Bloqueio de rota.", mistakes: "Tentar for√ßar porta bloqueada.", key: "O plano nunca sobrevive ao campo de batalha." },
                { id: 9, title: "Feedback Operacional", subtitle: "Debriefing", category: "Lideran√ßa", type: "lid", theory: ["Hot Wash: Reuni√£o de 3 min p√≥s-evento.", "Foco no Processo: Critique a a√ß√£o, n√£o a pessoa.", "Sandu√≠che: Elogio -> Corre√ß√£o -> Incentivo."], drill: "Simula√ß√£o de Feedback.", mistakes: "Humilhar colega.", key: "Sem feedback, o erro vira h√°bito." },
                { id: 10, title: "Cultura de Transpar√™ncia", subtitle: "Relato de Falhas", category: "Comportamental", type: "comp", theory: ["Quase-Acidente: Relate trope√ßos.", "Honestidade T√©cnica: 'N√£o sei' salva vidas.", "Cultura Justa: N√£o punimos erro honesto."], drill: "Roda da Verdade.", mistakes: "Esconder falha.", key: "Equipe que esconde erro, trabalha cega." }
            ],
            completed: [],

            init() {
                this.completed = JSON.parse(localStorage.getItem('hsm_2026_data')) || [];
                this.renderContent(this.modules);
                this.updateProgress();
            },

            toggleCard(id) {
                const card = document.getElementById(`card-${id}`);
                if(card) card.classList.toggle('active');
            },

            toggleStatus(e, id) {
                e.stopPropagation(); 
                const index = this.completed.indexOf(id);
                if (index > -1) this.completed.splice(index, 1);
                else this.completed.push(id);
                
                localStorage.setItem('hsm_2026_data', JSON.stringify(this.completed));
                this.renderContent(this.modules);
                this.updateProgress();
            },

            filter(cat, btnElement) {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');

                const container = document.getElementById('training-grid-container');
                container.style.opacity = '0';
                
                setTimeout(() => {
                    if (cat === 'todos') this.renderContent(this.modules);
                    else this.renderContent(this.modules.filter(m => m.category.includes(cat)));
                    container.style.opacity = '1';
                }, 200);
            },

            updateProgress() {
                const count = this.completed.length;
                const total = this.modules.length;
                const pct = Math.round((count/total)*100);
                
                document.getElementById('prog-text').innerText = count;
                document.getElementById('prog-percent').innerText = `${pct}%`;
                document.getElementById('fill').style.width = `${pct}%`;
            },

            renderContent(data) {
                const container = document.getElementById('training-grid-container');
                container.innerHTML = '';

                data.forEach(m => {
                    const isDone = this.completed.includes(m.id);
                    let badgeClass = m.type;

                    const html = `
                        <div class="module-card ${isDone ? 'done-border' : ''}" id="card-${m.id}">
                            <div class="card-header" onclick="treinamentosApp.toggleCard(${m.id})">
                                <div class="header-left">
                                    <div class="status-dot-t ${isDone ? 'done' : ''}">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="module-title">
                                        <h3 contenteditable="true" id="mod_${m.id}_title" onblur="globalEditor.save(this)">${m.title}</h3>
                                        <span contenteditable="true" id="mod_${m.id}_sub" onblur="globalEditor.save(this)">${m.subtitle}</span>
                                    </div>
                                </div>
                                <div style="display:flex; align-items:center; gap:15px;">
                                    <span class="badge ${badgeClass}">${m.category}</span>
                                    <i class="fas fa-chevron-down expand-icon"></i>
                                </div>
                            </div>

                            <div class="card-body">
                                <div class="content-wrapper">
                                    <div>
                                        <h4 class="training-h4"><i class="fas fa-book-open"></i> Pilares Te√≥ricos</h4>
                                        <ul class="theory-block">
                                            ${m.theory.map((t, idx) => `<li><span contenteditable="true" id="mod_${m.id}_theo_${idx}" onblur="globalEditor.save(this)">${t}</span></li>`).join('')}
                                        </ul>

                                        <div class="mistake-alert">
                                            <i class="fas fa-exclamation-triangle" style="margin-top:2px;"></i>
                                            <div>
                                                <strong>Erros para Corrigir:</strong><br>
                                                <span contenteditable="true" id="mod_${m.id}_mistake" onblur="globalEditor.save(this)">${m.mistakes}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <div class="drill-box">
                                            <h4 class="training-h4"><i class="fas fa-stopwatch"></i> Din√¢mica Pr√°tica</h4>
                                            <strong contenteditable="true" id="mod_${m.id}_drill" onblur="globalEditor.save(this)">"${m.drill}"</strong>
                                            <p style="margin-top:10px;" contenteditable="true" id="mod_${m.id}_key" onblur="globalEditor.save(this)">"${m.key}"</p>
                                        </div>

                                        <button class="action-btn ${isDone ? 'completed' : ''}" onclick="treinamentosApp.toggleStatus(event, ${m.id})">
                                            <i class="fas ${isDone ? 'fa-check-circle' : 'fa-circle'}"></i>
                                            ${isDone ? 'M√≥dulo Conclu√≠do' : 'Marcar como Conclu√≠do'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
                
                // IMPORTANTE: Recarrega as edi√ß√µes salvas sobre o template
                globalEditor.init();
            }
        };

        // INICIALIZA√á√ÉO
        window.onload = () => {
            globalEditor.init(); 
            escalaApp.init(); 
        };

    </script>
</body>
</html>